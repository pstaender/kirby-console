#!/usr/bin/env php
<?php

require getcwd() . '/kirby/bootstrap.php';

if (file_exists(getcwd() . '/vendor/autoload.php')) {
    require getcwd() . '/vendor/autoload.php';
} else {
    require __DIR__ . '/../vendor/autoload.php';
}

if (php_sapi_name() !== 'cli') {
    exit('This script can only be executed on cli');
}

$kirby = new Kirby();

// display help and exit?
array_filter($argv, function ($arg) use ($argv) {
    if ($arg === '-h' || $arg === '--help') {
        exit("Usage: ${argv[0]} (userEmail)\n");
    }
    return true;
});

$startupMessage = "Kirby v" . kirby()->version();

$email = $argv[1] ?? null;
if (!empty($email)) {
    $kirby->impersonate($email);
    $startupMessage .= " â€“ $email";
}

Zeitpulse\KirbyInteractiveShell::shell([
    'startupMessage' => $startupMessage,
])->run();
